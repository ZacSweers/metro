
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A multiplatform dependency injection framework for Kotlin">
      
      
        <meta name="author" content="Zac Sweers">
      
      
        <link rel="canonical" href="https://zacsweers.github.io/metro/0.5.5/dependency-graphs/">
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../provides/">
      
      
      <link rel="icon" href="../site-assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Dependency Graphs - Metro</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Dependency Graphs - Metro" >
      
        <meta  property="og:description"  content="A multiplatform dependency injection framework for Kotlin" >
      
        <meta  property="og:image"  content="https://zacsweers.github.io/metro/0.5.5/assets/images/social/dependency-graphs.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://zacsweers.github.io/metro/0.5.5/dependency-graphs/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Dependency Graphs - Metro" >
      
        <meta  name="twitter:description"  content="A multiplatform dependency injection framework for Kotlin" >
      
        <meta  name="twitter:image"  content="https://zacsweers.github.io/metro/0.5.5/assets/images/social/dependency-graphs.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dependency-graphs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Metro" class="md-header__button md-logo" aria-label="Metro" data-md-component="logo">
      
  <img src="../site-assets/img/metro-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metro
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dependency Graphs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZacSweers/metro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Metro
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Metro" class="md-nav__button md-logo" aria-label="Metro" data-md-component="logo">
      
  <img src="../site-assets/img/metro-icon.svg" alt="logo">

    </a>
    Metro
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZacSweers/metro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Metro
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../differences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Differences
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Dependency Graphs
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Dependency Graphs
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provides" class="md-nav__link">
    <span class="md-ellipsis">
      Provides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#includes" class="md-nav__link">
    <span class="md-ellipsis">
      Includes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extends" class="md-nav__link">
    <span class="md-ellipsis">
      Extends
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-factories" class="md-nav__link">
    <span class="md-ellipsis">
      Creating factories
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoping" class="md-nav__link">
    <span class="md-ellipsis">
      Scoping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Graph Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contributed-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Contributed Graph Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contributed Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Graph arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Binding Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Binding Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-via-includes-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Including via @Includes Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-via-dependencygraphbindingcontainers" class="md-nav__link">
    <span class="md-ellipsis">
      Including via @DependencyGraph.bindingContainers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Chaining Binding Containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributing-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing Binding Containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Provides
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../injection-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Injection Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scopes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scopes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metro-intrinsics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metro Intrinsics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bindings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aggregation (aka "Anvil")
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiplatform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multiplatform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation-and-error-reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validation & Error Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generating-metro-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating Custom Metro Code
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compatibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compatibility
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adoption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adoption Strategies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../samples.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Samples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/0.x/index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ZacSweers/metro/discussions" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Discussions ⏏
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Change Log
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-of-conduct.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CoC
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provides" class="md-nav__link">
    <span class="md-ellipsis">
      Provides
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#includes" class="md-nav__link">
    <span class="md-ellipsis">
      Includes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extends" class="md-nav__link">
    <span class="md-ellipsis">
      Extends
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-factories" class="md-nav__link">
    <span class="md-ellipsis">
      Creating factories
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoping" class="md-nav__link">
    <span class="md-ellipsis">
      Scoping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Graph Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#contributed-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Contributed Graph Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contributed Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Graph arguments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Binding Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Binding Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-via-includes-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Including via @Includes Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-via-dependencygraphbindingcontainers" class="md-nav__link">
    <span class="md-ellipsis">
      Including via @DependencyGraph.bindingContainers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Chaining Binding Containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributing-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      Contributing Binding Containers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="dependency-graphs">Dependency Graphs<a class="headerlink" href="#dependency-graphs" title="Permanent link">&para;</a></h1>
<p>The primary entry points in Metro are <em>dependency graphs</em>. These are interfaces annotated with <code>@DependencyGraph</code> and created with <code>@DependencyGraph.Factory</code> interfaces. Graphs expose types from the object graph via accessor properties or functions.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>These are synonymous with <em>components</em> and <code>@Component</code>/<code>@Component.Factory</code> in Dagger and kotlin-inject.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>“Accessors” in Metro are synonymous with Dagger’s <a href="https://dagger.dev/api/latest/dagger/Component.html#provision-methods">provision methods</a>.</p>
</div>
<p>Accessors and member injections act as roots, from which the dependency graph is resolved. Dependencies can be provided via conventional <code>@Provides</code> functions in graphs or their supertypes, constructor-injected classes, or accessed from graph dependencies.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@Provides</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Note the <code>@Provides</code> function must define an explicit return type.</em></p>
<p>Simple graphs like this can be created via the <code>createGraph()</code> intrinsic.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createGraph</span><span class="o">&lt;</span><span class="n">AppGraph</span><span class="o">&gt;</span><span class="p">()</span>
</code></pre></div>
<p>Graphs are relatively cheap and should be used freely.</p>
<h2 id="inputs">Inputs<a class="headerlink" href="#inputs" title="Permanent link">&para;</a></h2>
<p>Runtime inputs can be provided via a <code>@DependencyGraph.Factory</code> interface that returns the target graph. These parameters must be annotated with exactly one of <code>@Provides</code>, <code>@Includes</code>, or <code>@Extends</code>.</p>
<h3 id="provides">Provides<a class="headerlink" href="#provides" title="Permanent link">&para;</a></h3>
<p>The simplest input is an instance parameter annotated with <code>@Provides</code>. This provides this instance as an available binding on the graph.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Provides</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Provided parameters may be any type.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is analogous to Dagger&rsquo;s <code>@BindsInstance</code>.</p>
</div>
<h3 id="includes">Includes<a class="headerlink" href="#includes" title="Permanent link">&para;</a></h3>
<p><code>@Includes</code>-annotated parameters are treated as containers of available bindings. Metro will treat <em>accessors</em> of these types as usable dependencies.</p>
<p>They are commonly other graph types whose&rsquo; dependencies you want to consume via explicit API.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">messageGraph</span><span class="p">:</span><span class="w"> </span><span class="n">MessageGraph</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@DependencyGraph</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">MessageGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">    </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>@Includes</code> instance dependencies do not <em>need</em> to be other graphs though! They can be any regular class type. They <em>cannot</em> be enums or annotation classes.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">messageProvider</span><span class="p">:</span><span class="w"> </span><span class="n">MessageProvider</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">MessageProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Includes parameters cannot be injected from the graph.</p>
</div>
<p><a href="#binding-containers">Binding Containers</a> are a special type of <code>@Includes</code> type, see more in its section below.</p>
<h3 id="extends">Extends<a class="headerlink" href="#extends" title="Permanent link">&para;</a></h3>
<p><code>@Extends</code>-annotated parameters are for extending parent graphs. See <em>Graph Extensions</em> at the bottom of this doc for more information.</p>
<h3 id="creating-factories">Creating factories<a class="headerlink" href="#creating-factories" title="Permanent link">&para;</a></h3>
<p>Graph factories can be created with the <code>createGraphFactory()</code> intrinsic.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">messageGraph</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">createGraphFactory</span><span class="o">&lt;</span><span class="n">AppGraph</span><span class="p">.</span><span class="na">Factory</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="scoping">Scoping<a class="headerlink" href="#scoping" title="Permanent link">&para;</a></h2>
<p><em>See <a href="../scopes/">Scopes</a> for more details on scopes!</em></p>
<p>Graphs may declare a <code>scope</code> (and optionally <code>additionalScopes</code> if there are more). Each of these declared scopes act as an implicit <code>@SingleIn</code> representation of that scope for <a href="../aggregation/">aggregation</a>.</p>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div></p>
<p>Is functionally equivalent to writing the below.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SingleIn</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<h2 id="graph-extensions">Graph Extensions<a class="headerlink" href="#graph-extensions" title="Permanent link">&para;</a></h2>
<p>Dependency graphs can be marked as <em>extendable</em> to allow child graphs to extend them. These are similar in functionality to Dagger&rsquo;s <code>Subcomponents</code> but are detached in nature like in kotlin-inject.</p>
<p>A graph must opt itself into extension in via <code>@DependencyGraph(..., isExtendable = true)</code>, which will make the Metro compiler generate extra metadata for downstream child graphs.</p>
<p>Then, a child graph can add an <code>@Extends</code>-annotated parameter to its creator to extend that graph.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">isExtendable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">UserGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Extends</span><span class="w"> </span><span class="n">appGraph</span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="p">):</span><span class="w"> </span><span class="n">UserGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Child graphs then contain a <em>superset</em> of bindings they can inject, including both their bindings and their parents&rsquo;. Graph extensions can be chained as well.</p>
<p>Child graphs also implicitly inherit their parents&rsquo; <em>scopes</em>.</p>
<div class="admonition tip">
<p class="admonition-title">Hoisting unused scoped class injections in parent graphs</p>
<p>In some cases, there are scoped bindings that are unused in the parent graph but <em>are</em> used in child graphs. Due to the detached nature of graph extensions, these bindings by default end up scoped to the child. To enforce that these bindings are scoped and held by the parent, Metro generates hints for these classes and discovers them during graph processing by default. You can disable this via the <code>enableScopedInjectClassHints</code> property in the Gradle DSL.</p>
<p>See <a href="https://github.com/ZacSweers/metro/issues/377">https://github.com/ZacSweers/metro/issues/377</a> for more details.</p>
</div>
<h3 id="contributed-graph-extensions">Contributed Graph Extensions<a class="headerlink" href="#contributed-graph-extensions" title="Permanent link">&para;</a></h3>
<p><code>@ContributesGraphExtension</code> is a specialized type of graph that is <em>contributed</em> to some parent scope. Its generation is deferred until the parent graph interface is merged.</p>
<h4 id="the-problem">The Problem<a class="headerlink" href="#the-problem" title="Permanent link">&para;</a></h4>
<p>Imagine this module dependency tree:</p>
<div class="highlight"><pre><span></span><code>        :app
      /     \
     v       v
  :login   :user-data
</code></pre></div>
<p><code>:app</code> defines the main dependency graph with <code>@DependencyGraph</code>. The <code>:login</code> module defines a graph extension for authenticated user flows, and <code>:user-data</code> provides some core functionality like <code>UserRepository</code>.</p>
<p>If <code>:login</code> defines its own graph directly with <code>@DependencyGraph</code>, it won&rsquo;t see contributions from <code>:user-data</code> <em>unless</em> <code>:login</code> depends on it directly.</p>
<h4 id="the-solution">The Solution<a class="headerlink" href="#the-solution" title="Permanent link">&para;</a></h4>
<p>Instead, <code>:login</code> can use <code>@ContributesGraphExtension(LoggedInScope::class)</code> + an associated <code>@ContributesGraphExtension.Factory(AppScope::class)</code> to say: &ldquo;I want to contribute a new graph extension <em>to</em> a future <code>AppScope</code> parent graph.&rdquo;</p>
<p>The graph extension will then be generated in <code>:app</code>, which already depends on both <code>:login</code> and <code>:user-data</code>. Now <code>UserRepository</code> can be injected in <code>LoggedInGraph</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ContributesGraphExtension</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">userRepository</span><span class="p">:</span><span class="w"> </span><span class="n">UserRepository</span>

<span class="w">  </span><span class="nd">@ContributesGraphExtension.Factory</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In the <code>:app</code> module:</p>
<div class="highlight"><pre><span></span><code>@DependencyGraph(AppScope::class, isExtendable = true)
interface AppGraph
</code></pre></div>
<p>The generated code will modify <code>AppGraph</code> to implement <code>LoggedInGraph.Factory</code> and implement <code>createLoggedInGraph()</code> using a generated final <code>$$ContributedLoggedInGraph</code> class that includes all contributed bindings, including <code>UserRepository</code> from <code>:user-data</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span>
<span class="w">  </span><span class="c1">// modifications generated during compile-time</span>
<span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="err">$$</span><span class="n">ContributedLoggedInGraph</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Generated in IR</span>
<span class="w">  </span><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="err">$$</span><span class="n">MetroGraph</span><span class="p">(</span><span class="n">appGraph</span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Finally, you can obtain a <code>LoggedInGraph</code> instance from <code>AppGraph</code> since it now implements <code>LoggedInGraph.Factory</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Using the asContribution() intrinsic</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appGraph</span><span class="p">.</span><span class="na">asContribution</span><span class="o">&lt;</span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span><span class="o">&gt;</span><span class="p">().</span><span class="na">createLoggedInGraph</span><span class="p">()</span>

<span class="c1">// Or if you have IDE support enabled</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appGraph</span><span class="p">.</span><span class="na">createLoggedInGraph</span><span class="p">()</span>
</code></pre></div>
<h4 id="graph-arguments">Graph arguments<a class="headerlink" href="#graph-arguments" title="Permanent link">&para;</a></h4>
<p>You can pass arguments to the graph via the factory:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ContributesGraphExtension.Factory</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Provides</span><span class="w"> </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="p">}</span>
</code></pre></div>
<p>This maps to:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated in IR</span>
<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="err">$$</span><span class="nc">ContributedLoggedInGraph</span><span class="p">(</span>
<span class="w">  </span><span class="nd">@Extends</span><span class="w"> </span><span class="n">parent</span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="p">,</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>In <code>AppGraph</code>, the generated factory method looks like:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated in IR</span>
<span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="err">$$</span><span class="n">MetroGraph</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Abstract factory classes cannot be used as graph contributions.</p>
</div>
<p>Contributed graphs may also be chained, but note that <code>@ContributesGraphExtension.isExtendable</code> must be true to do so!</p>
<h2 id="binding-containers">Binding Containers<a class="headerlink" href="#binding-containers" title="Permanent link">&para;</a></h2>
<p>Binding containers are classes, objects, or interfaces annotated with <code>@BindingContainer</code> that contain binding declarations (<code>@Provides</code> or <code>@Binds</code>) but are not themselves complete dependency graphs. They&rsquo;re analogous to Dagger&rsquo;s <code>@Module</code> annotation and can be used in cases where defining bindings in an (extended) interface is unwieldy or not helpful.</p>
<p>Unlike graphs and other <code>@Includes</code> types, their public accessors are <em>not</em> read. Only <code>@Binds</code> and <code>@Provides</code> declarations are read.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Binding containers can be seen as partial graphs and are intended to be reusable, composable units that are <em>included</em> in a complete graph.</p>
</div>
<h3 id="including-via-includes-parameters">Including via <code>@Includes</code> Parameters<a class="headerlink" href="#including-via-includes-parameters" title="Permanent link">&para;</a></h3>
<p>The most flexible way to include binding containers is via <code>@Includes</code>-annotated parameters on graph factories.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">baseUrl</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">baseUrl</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">networkBindings</span><span class="p">:</span><span class="w"> </span><span class="n">NetworkBindings</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This allows you to bring any instance to the graph with its own internal logic.</p>
<h3 id="including-via-dependencygraphbindingcontainers">Including via <code>@DependencyGraph.bindingContainers</code><a class="headerlink" href="#including-via-dependencygraphbindingcontainers" title="Permanent link">&para;</a></h3>
<p>For simple binding containers, you can declare them directly in the graph annotation:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">bindingContainers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>This method works for:</p>
<ul>
<li><code>object</code> classes</li>
<li><code>interface</code> or <code>abstract class</code> types with only <code>@Binds</code> providers or companion object <code>@Provides</code> providers</li>
<li>Simple classes with a public, no-arg constructor</li>
</ul>
<h3 id="chaining-binding-containers">Chaining Binding Containers<a class="headerlink" href="#chaining-binding-containers" title="Permanent link">&para;</a></h3>
<p>Binding containers can include other binding containers using the <code>includes</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">CacheBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpCache</span><span class="p">():</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cache</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@BindingContainer</span><span class="p">(</span><span class="n">includes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">CacheBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">(</span><span class="n">cache</span><span class="p">:</span><span class="w"> </span><span class="n">Cache</span><span class="p">):</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">bindingContainers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>The transitive closure of all included binding containers will be included in the final consuming graph.</p>
<h3 id="contributing-binding-containers">Contributing Binding Containers<a class="headerlink" href="#contributing-binding-containers" title="Permanent link">&para;</a></h3>
<p>Binding containers can be contributed to scopes via <code>@ContributesTo</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>They can also replace other contributed binding containers:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// In a test variant</span>
<span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">replaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">FakeNetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideFakeHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FakeHttpClient</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Graphs may exclude contributed containers:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">excludes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<ul>
<li>Companion objects, annotation classes, and enum classes/entries cannot be annotated with <code>@BindingContainer</code>.</li>
<li>Provides within a binding container&rsquo;s companion object are automatically included.</li>
<li>Enclosing classes of <code>@Binds</code> or <code>@Provides</code> providers don&rsquo;t need to be annotated with <code>@BindingContainer</code> for Metro to process them - the annotation is primarily for reference to <code>@DependencyGraph.Factory</code> and the ability to use <code>includes</code>.</li>
<li>Binding containers may also be <a href="../aggregation/#contributing-binding-containers">contributed</a>.</li>
<li>See <a href="https://github.com/ZacSweers/metro/issues/172">#172</a> for more details.</li>
</ul>
<h2 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h2>
<p>Dependency graph code gen is designed to largely match how Dagger components are generated.</p>
<ul>
<li>Internal graph validation uses <a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm">Tarjan&rsquo;s algorithm</a> + <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological sort</a> implementation.</li>
<li>This runs in O(V+E) time</li>
<li>The returned ordered list of bindings can be used to determine provider field generation order.</li>
<li>Any binding whose order depends on one later in the returned order implicitly requires use of <code>DelegateFactory</code>.</li>
<li>Dependencies are traversed from public accessors and <code>inject()</code> functions.</li>
<li>Metro generates Provider Factory classes for each provider. These should be generated at the same time that the provider is compiled so that their factory classes. This is for two primary purposes:<ul>
<li>They can be reused to avoid code duplication</li>
<li>Metro can copy default values for provider values over to the generated factory to support optional bindings. Since default values may refer to private references, we must generate these factories as nested classes.</li>
</ul>
</li>
<li>Metro generates a graph <em>impl</em> class that holds all aggregated bindings and manages scoping.</li>
<li>Scoped bindings are stored in provider fields backed by <code>DoubleCheck</code>.</li>
<li>Reused unscoped providers instances are stored in reusable fields.</li>
<li><code>@Provides</code> factory parameters are stored in a field backed by <code>InstanceFactory</code>.</li>
<li>Multibindings create new collection instances every time.</li>
<li>Multibinding providers are not accessible as standalone bindings.</li>
<li>Graph extensions are implemented via a combination of things<ul>
<li>Custom <code>MetroMetadata</code> is generated and serialized into Kotlin&rsquo;s <code>Metadata</code> annotations.</li>
<li>Extendable parent graphs opt-in to generating this metadata. They write information about their available provider and instance fields, binds callable IDs, parent graphs, and provides callable IDs.</li>
<li>Extendable parent graphs generate <code>_metroAccessor</code>-suffixed <code>internal</code> functions that expose instance fields and provider fields.</li>
<li>Child graphs read this metadata and look up the relevant callable symbols, then incorporating these when building its own binding graph.</li>
</ul>
</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Zac Sweers
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>