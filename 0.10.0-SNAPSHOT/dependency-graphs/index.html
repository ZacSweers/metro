
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A multiplatform dependency injection framework for Kotlin">
      
      
        <meta name="author" content="Zac Sweers">
      
      
        <link rel="canonical" href="https://zacsweers.github.io/metro/0.10.0-SNAPSHOT/dependency-graphs/">
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../provides/">
      
      
        
      
      
      <link rel="icon" href="../site-assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Dependency Graphs - Metro</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="Dependency Graphs - Metro" />
<meta property="og:description" content="A multiplatform dependency injection framework for Kotlin" />
<meta property="og:image" content="https://zacsweers.github.io/metro/0.10.0-SNAPSHOT/assets/images/social/dependency-graphs.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://zacsweers.github.io/metro/0.10.0-SNAPSHOT/dependency-graphs/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="Dependency Graphs - Metro" />
<meta property="twitter:description" content="A multiplatform dependency injection framework for Kotlin" />
<meta property="twitter:image" content="https://zacsweers.github.io/metro/0.10.0-SNAPSHOT/assets/images/social/dependency-graphs.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dependency-graphs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Metro" class="md-header__button md-logo" aria-label="Metro" data-md-component="logo">
      
  <img src="../site-assets/img/metro-icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metro
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dependency Graphs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZacSweers/metro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Metro
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Metro" class="md-nav__button md-logo" aria-label="Metro" data-md-component="logo">
      
  <img src="../site-assets/img/metro-icon.svg" alt="logo">

    </a>
    Metro
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZacSweers/metro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Metro
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../differences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Differences
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Dependency Graphs
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependency Graphs
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provides" class="md-nav__link">
    <span class="md-ellipsis">
      
        Provides
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#includes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Includes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-factories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating factories
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph Extensions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Graph Extensions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scoping_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Providers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creators" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creators
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aggregation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributed-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributed Graph Extensions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contributed Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph arguments
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Binding Containers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Binding Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-via-includes-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Including via @Includes Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-via-dependencygraphbindingcontainers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Including via @DependencyGraph.bindingContainers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chaining Binding Containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributing-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributing Binding Containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Graphs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Implementation Notes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Implementation Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unused-binding-elimination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unused binding elimination
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Property collection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sharding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switching-providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switching Providers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../provides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Provides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../injection-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Injection Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scopes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scopes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metro-intrinsics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Metro Intrinsics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bindings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bindings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aggregation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregation (aka "Anvil")
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multiplatform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multiplatform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation-and-error-reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation & Error Reporting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generating-metro-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generating Custom Metro Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graph Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compatibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compatibility
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../stability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stability
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adoption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adoption Strategies
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../samples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Samples
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    MetroX
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    MetroX
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrox-android/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Android
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrox-viewmodel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ViewModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrox-viewmodel-compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ViewModel Compose
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../designdoc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Doc
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ZacSweers/metro/discussions" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Discussions ⏏
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Change Log
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-of-conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CoC
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provides" class="md-nav__link">
    <span class="md-ellipsis">
      
        Provides
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#includes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Includes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-factories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating factories
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph Extensions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Graph Extensions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scoping_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scoping
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Providers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creators" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creators
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aggregation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributed-graph-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributed Graph Extensions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contributed Graph Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Problem
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graph arguments
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Binding Containers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Binding Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#including-via-includes-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Including via @Includes Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#including-via-dependencygraphbindingcontainers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Including via @DependencyGraph.bindingContainers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chaining Binding Containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contributing-binding-containers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributing Binding Containers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-graphs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Graphs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Implementation Notes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Implementation Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unused-binding-elimination" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unused binding elimination
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Property collection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chunking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chunking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sharding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sharding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switching-providers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Switching Providers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/ZacSweers/metro/edit/main/docs/dependency-graphs.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/ZacSweers/metro/raw/main/docs/dependency-graphs.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="dependency-graphs">Dependency Graphs<a class="headerlink" href="#dependency-graphs" title="Permanent link">&para;</a></h1>
<p>The primary entry points in Metro are <em>dependency graphs</em>. These are interfaces annotated with <code>@DependencyGraph</code> and created with <code>@DependencyGraph.Factory</code> interfaces. Graphs expose types from the object graph via accessor properties or functions.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>These are synonymous with <em>components</em> and <code>@Component</code>/<code>@Component.Factory</code> in Dagger and kotlin-inject.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>“Accessors” in Metro are synonymous with Dagger’s <a href="https://dagger.dev/api/latest/dagger/Component.html#provision-methods">provision methods</a>.</p>
</div>
<p>Accessors and member injections act as roots, from which the dependency graph is resolved. Dependencies can be provided via conventional <code>@Provides</code> functions in graphs or their supertypes, constructor-injected classes, or accessed from graph dependencies.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@Provides</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><em>Note the <code>@Provides</code> function must define an explicit return type.</em></p>
<p>Simple graphs like this can be created via the <code>createGraph()</code> intrinsic.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">graph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createGraph</span><span class="o">&lt;</span><span class="n">AppGraph</span><span class="o">&gt;</span><span class="p">()</span>
</code></pre></div>
<p>Graphs are relatively cheap and should be used freely.</p>
<h2 id="inputs">Inputs<a class="headerlink" href="#inputs" title="Permanent link">&para;</a></h2>
<p>Runtime inputs can be provided via a <code>@DependencyGraph.Factory</code> interface that returns the target graph. These parameters must be annotated with either <code>@Provides</code> or <code>@Includes</code>.</p>
<h3 id="provides">Provides<a class="headerlink" href="#provides" title="Permanent link">&para;</a></h3>
<p>The simplest input is an instance parameter annotated with <code>@Provides</code>. This provides this instance as an available binding on the graph.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Provides</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Provided parameters may be any type.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is analogous to Dagger&rsquo;s <code>@BindsInstance</code>.</p>
</div>
<h3 id="includes">Includes<a class="headerlink" href="#includes" title="Permanent link">&para;</a></h3>
<p><code>@Includes</code>-annotated parameters are treated as containers of available bindings. Metro will treat <em>accessors</em> of these types as usable dependencies.</p>
<p>They are commonly other graph types whose&rsquo; dependencies you want to consume via explicit API.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">messageGraph</span><span class="p">:</span><span class="w"> </span><span class="n">MessageGraph</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@DependencyGraph</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">MessageGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">    </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>@Includes</code> instance dependencies do not <em>need</em> to be other graphs though! They can be any regular class type. They <em>cannot</em> be enums or annotation classes.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">messageProvider</span><span class="p">:</span><span class="w"> </span><span class="n">MessageProvider</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">MessageProvider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Includes parameters cannot be injected from the graph.</p>
</div>
<p><a href="#binding-containers">Binding Containers</a> are a special type of <code>@Includes</code> type, see more in its section below.</p>
<h3 id="creating-factories">Creating factories<a class="headerlink" href="#creating-factories" title="Permanent link">&para;</a></h3>
<p>Graph factories can be created with the <code>createGraphFactory()</code> intrinsic.</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">messageGraph</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">createGraphFactory</span><span class="o">&lt;</span><span class="n">AppGraph</span><span class="p">.</span><span class="na">Factory</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">&quot;Hello, world!&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="scoping">Scoping<a class="headerlink" href="#scoping" title="Permanent link">&para;</a></h2>
<p><em>See <a href="../scopes/">Scopes</a> for more details on scopes!</em></p>
<p>Graphs may declare a <code>scope</code> (and optionally <code>additionalScopes</code> if there are more). Each of these declared scopes act as an implicit <code>@SingleIn</code> representation of that scope for <a href="../aggregation/">aggregation</a>.</p>
<p>For example:<br />
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div></p>
<p>Is functionally equivalent to writing the below.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SingleIn</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<h2 id="graph-extensions">Graph Extensions<a class="headerlink" href="#graph-extensions" title="Permanent link">&para;</a></h2>
<p>Dependency graphs can be extended via <em>graph extensions</em>. As the name implies, graph extensions <em>extend</em> a parent graph they are declared for and contain a superset of bindings that includes both the parent graph(s) as well as their own. These are similar in functionality to Dagger&rsquo;s <em>Subcomponents</em>.</p>
<p>Graph extensions must be either an interface or an abstract class and are annotated with <code>@GraphExtension</code>. They are created via <code>@GraphExtension.Factory</code> types.</p>
<p>Metro&rsquo;s compiler plugin will build, validate, and implement this graph at compile-time <em>when the parent graph is generated</em>. This means that graph extensions are not available until the parent graph is generated.</p>
<p>Graph extensions can be chained and implicitly inherit their parents&rsquo; scopes.</p>
<h3 id="creating-graph-extensions">Creating Graph Extensions<a class="headerlink" href="#creating-graph-extensions" title="Permanent link">&para;</a></h3>
<p>You cannot create a graph extension independent of its parent graph, you may only access it via accessor on the parent graph. You can declare this in multiple ways:</p>
<ul>
<li>Declare an accessor on the parent graph directly.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraph</span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>(If the extension has a creator) declare the creator on the parent graph directly.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@GraphExtension.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraphFactory</span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>(If the extension has a creator) make the parent graph implement the creator.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@GraphExtension.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span>
</code></pre></div>
<ul>
<li>Contribute the factory to the parent graph via <a href="#contributed-graph-extensions">@ContributesTo</a>. More on this below.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@GraphExtension.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<h3 id="scoping_1">Scoping<a class="headerlink" href="#scoping_1" title="Permanent link">&para;</a></h3>
<p><em>See <a href="../scopes/">Scopes</a> for more details on scopes!</em></p>
<p>Like <a href="#scoping">DependencyGraph</a>, graph extensions may declare a <code>scope</code> (and optionally <code>additionalScopes</code> if there are more). Each of these declared scopes act as an implicit <code>@SingleIn</code> representation of that scope. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<p>Is functionally equivalent to writing the below.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@SingleIn</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@GraphExtension</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<h3 id="providers">Providers<a class="headerlink" href="#providers" title="Permanent link">&para;</a></h3>
<p>Like <a href="#dependency-graphs">DependencyGraph</a>, graph extensions may declare providers via <code>@Provides</code> and <code>@Binds</code> to provide dependencies into the graph.</p>
<p><em>Creators</em> can provide instance dependencies and other graphs as dependencies.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>

<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="creators">Creators<a class="headerlink" href="#creators" title="Permanent link">&para;</a></h3>
<p>See <a href="#inputs">DependencyGraph</a>&rsquo;s section on creators.</p>
<h3 id="aggregation">Aggregation<a class="headerlink" href="#aggregation" title="Permanent link">&para;</a></h3>
<p>See <a href="#scoping">DependencyGraph</a>&rsquo;s section on aggregation.</p>
<h3 id="contributed-graph-extensions">Contributed Graph Extensions<a class="headerlink" href="#contributed-graph-extensions" title="Permanent link">&para;</a></h3>
<p>Graph extensions may be <em>contributed</em> to a parent graph and its contribution merging will be deferred until the parent graph is generated.</p>
<h4 id="the-problem">The Problem<a class="headerlink" href="#the-problem" title="Permanent link">&para;</a></h4>
<p>Imagine this module dependency tree:</p>
<div class="highlight"><pre><span></span><code>        :app
      /     \
     v       v
  :login   :user-data
</code></pre></div>
<p><code>:app</code> defines the main dependency graph with <code>@DependencyGraph</code>. The <code>:login</code> module defines a graph extension for authenticated user flows, and <code>:user-data</code> provides some core functionality like <code>UserRepository</code>.</p>
<p>If <code>:login</code> defines its own graph directly with <code>@DependencyGraph</code>, it won&rsquo;t see contributions from <code>:user-data</code> <em>unless</em> <code>:login</code> depends on it directly.</p>
<h4 id="the-solution">The Solution<a class="headerlink" href="#the-solution" title="Permanent link">&para;</a></h4>
<p>Instead, <code>:login</code> can use <code>@GraphExtension(LoggedInScope::class)</code> + <code>@ContributesTo</code> on its associated factory to say: &ldquo;I want to contribute a new graph extension <em>to</em> a future <code>AppScope</code> parent graph.&rdquo;</p>
<p>The graph extension will then be generated in <code>:app</code>, which already depends on both <code>:login</code> and <code>:user-data</code>. Now <code>UserRepository</code> can be injected in <code>LoggedInGraph</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@GraphExtension</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">userRepository</span><span class="p">:</span><span class="w"> </span><span class="n">UserRepository</span>

<span class="w">  </span><span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="w">  </span><span class="nd">@GraphExtension.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In the <code>:app</code> module:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
</code></pre></div>
<p>The generated code will modify <code>AppGraph</code> to implement <code>LoggedInGraph.Factory</code> and implement <code>createLoggedInGraph()</code> using a generated final <code>LoggedInGraphImpl</code> class that includes all contributed bindings, including <code>UserRepository</code> from <code>:user-data</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span>
<span class="c1">// modifications generated during compile-time</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createLoggedInGraph</span><span class="p">():</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">LoggedInGraphImpl</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Generated in IR</span>
<span class="w">  </span><span class="kd">class</span><span class="w"> </span><span class="err">$$</span><span class="nc">MetroGraph</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nc">LoggedInGraphImpl</span><span class="p">(</span><span class="n">appGraph</span><span class="p">:</span><span class="w"> </span><span class="err">$$</span><span class="n">MetroGraph</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Finally, you can obtain a <code>LoggedInGraph</code> instance from <code>AppGraph</code> since it now implements <code>LoggedInGraph.Factory</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Using the asContribution() intrinsic</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appGraph</span><span class="p">.</span><span class="na">asContribution</span><span class="o">&lt;</span><span class="n">LoggedInGraph</span><span class="p">.</span><span class="na">Factory</span><span class="o">&gt;</span><span class="p">().</span><span class="na">createLoggedInGraph</span><span class="p">()</span>

<span class="c1">// Or if you have IDE support enabled</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">loggedInGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appGraph</span><span class="p">.</span><span class="na">createLoggedInGraph</span><span class="p">()</span>
</code></pre></div>
<h4 id="graph-arguments">Graph arguments<a class="headerlink" href="#graph-arguments" title="Permanent link">&para;</a></h4>
<p>You can pass arguments to the graph via the factory:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@GraphExtension.Factory</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Provides</span><span class="w"> </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span>
<span class="p">}</span>
</code></pre></div>
<p>This maps to:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated in IR</span>
<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">LoggedInScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">LoggedInGraphImpl</span><span class="p">(</span>
<span class="w">  </span><span class="n">parent</span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="p">,</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
<span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>In <code>AppGraph</code>, the generated factory method looks like:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated in IR</span>
<span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">LoggedInGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">LoggedInGraphImpl</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Abstract factory classes cannot be used as graph contributions.</p>
</div>
<p>Contributed graphs may also be chained.</p>
<h2 id="binding-containers">Binding Containers<a class="headerlink" href="#binding-containers" title="Permanent link">&para;</a></h2>
<p>Binding containers are classes, objects, or interfaces annotated with <code>@BindingContainer</code> that contain binding declarations (<code>@Provides</code> or <code>@Binds</code>) but are not themselves complete dependency graphs. They&rsquo;re analogous to Dagger&rsquo;s <code>@Module</code> annotation and can be used in cases where defining bindings in an (extended) interface is unwieldy or not helpful.</p>
<p>Unlike graphs and other <code>@Includes</code> types, their public accessors are <em>not</em> read. Only <code>@Binds</code> and <code>@Provides</code> declarations are read.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Binding containers can be seen as partial graphs and are intended to be reusable, composable units that are <em>included</em> in a complete graph.</p>
</div>
<h3 id="including-via-includes-parameters">Including via <code>@Includes</code> Parameters<a class="headerlink" href="#including-via-includes-parameters" title="Permanent link">&para;</a></h3>
<p>The most flexible way to include binding containers is via <code>@Includes</code>-annotated parameters on graph factories.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">baseUrl</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">baseUrl</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>

<span class="w">  </span><span class="nd">@DependencyGraph.Factory</span>
<span class="w">  </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="nd">@Includes</span><span class="w"> </span><span class="n">networkBindings</span><span class="p">:</span><span class="w"> </span><span class="n">NetworkBindings</span><span class="p">):</span><span class="w"> </span><span class="n">AppGraph</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This allows you to bring any instance to the graph with its own internal logic.</p>
<h3 id="including-via-dependencygraphbindingcontainers">Including via <code>@DependencyGraph.bindingContainers</code><a class="headerlink" href="#including-via-dependencygraphbindingcontainers" title="Permanent link">&para;</a></h3>
<p>For simple binding containers, you can declare them directly in the graph annotation:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">bindingContainers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>This method works for:</p>
<ul>
<li><code>object</code> classes</li>
<li><code>interface</code> or <code>abstract class</code> types with only <code>@Binds</code> providers or companion object <code>@Provides</code> providers</li>
<li>Simple classes with a public, no-arg constructor</li>
</ul>
<h3 id="chaining-binding-containers">Chaining Binding Containers<a class="headerlink" href="#chaining-binding-containers" title="Permanent link">&para;</a></h3>
<p>Binding containers can include other binding containers using the <code>includes</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">CacheBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpCache</span><span class="p">():</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cache</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@BindingContainer</span><span class="p">(</span><span class="n">includes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">CacheBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">(</span><span class="n">cache</span><span class="p">:</span><span class="w"> </span><span class="n">Cache</span><span class="p">):</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">bindingContainers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>The transitive closure of all included binding containers will be included in the final consuming graph.</p>
<h3 id="contributing-binding-containers">Contributing Binding Containers<a class="headerlink" href="#contributing-binding-containers" title="Permanent link">&para;</a></h3>
<p>Binding containers can be contributed to scopes via <code>@ContributesTo</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>
<span class="p">}</span>

<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<p>They can also replace other contributed binding containers:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// In a test variant</span>
<span class="nd">@ContributesTo</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">replaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="nd">@BindingContainer</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">FakeNetworkBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideFakeHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FakeHttpClient</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Graphs may exclude contributed containers:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">excludes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">NetworkBindings</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<ul>
<li>Companion objects, annotation classes, and enum classes/entries cannot be annotated with <code>@BindingContainer</code>.</li>
<li>Provides within a binding container&rsquo;s companion object are automatically included.</li>
<li>Enclosing classes of <code>@Binds</code> or <code>@Provides</code> providers don&rsquo;t need to be annotated with <code>@BindingContainer</code> for Metro to process them - the annotation is primarily for reference to <code>@DependencyGraph.Factory</code> and the ability to use <code>includes</code>.</li>
<li>Binding containers may also be <a href="../aggregation/#contributing-binding-containers">contributed</a>.</li>
<li>See <a href="https://github.com/ZacSweers/metro/issues/172">#172</a> for more details.</li>
</ul>
<h2 id="dynamic-graphs">Dynamic Graphs<a class="headerlink" href="#dynamic-graphs" title="Permanent link">&para;</a></h2>
<p>Dynamic graphs are a powerful feature of the Metro compiler that allow for dynamically replacing bindings in a given graph. To use them, you can pass in a vararg set of <em>binding containers</em> to the <code>createDynamicGraph()</code> and <code>createDynamicGraphFactory()</code> intrinsics.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">message</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>

<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;real&quot;</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">AppTest</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">testGraph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createDynamicGraph</span><span class="o">&lt;</span><span class="n">AppGraph</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FakeBindings</span><span class="p">)</span>

<span class="w">  </span><span class="nd">@Test</span>
<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&quot;fake&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">testGraph</span><span class="p">.</span><span class="na">message</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@BindingContainer</span>
<span class="w">  </span><span class="kd">object</span><span class="w"> </span><span class="nc">FakeBindings</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideMessage</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fake&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The compiler will dynamically generate a hidden graph impl <em>within the enclosing class or file</em> that is unique to the combination of input [containers] and target type [T].</p>
<p><strong>Constraints</strong></p>
<ul>
<li>All containers must be instances (or objects) of <em>binding containers</em>.</li>
<li>It&rsquo;s an error to pass no containers.</li>
<li>All containers must be non-local, canonical classes. i.e., they must be something with a name!</li>
<li>This overload may be called in a member function body, top-level function body, or property<br />
  initializer.</li>
<li>The target [T] graph <em>must</em> be annotated with <code>@DependencyGraph</code> and must be a<br />
  valid graph on its own.</li>
</ul>
<details class="note">
<summary>Implementation Notes</summary>
<ul>
<li>The bulk of this implementation is in <code>IrDynamicGraphGenerator</code>.</li>
<li>The generated graph impl is a private nested (static) class of the enclosing class or file.</li>
<li>This doesn&rsquo;t swap bindings in a real graph or use a real graph at all, instead tracking available dynamic bindings and preferring them when constructing a graph in <code>BindingGraphGenerator</code>.</li>
</ul>
</details>
<h2 id="general-implementation-notes">General Implementation Notes<a class="headerlink" href="#general-implementation-notes" title="Permanent link">&para;</a></h2>
<p>Dependency graph code gen is designed to largely match how Dagger components are generated.</p>
<ul>
<li>Internal graph validation uses <a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm">Tarjan&rsquo;s algorithm</a> + <a href="https://en.wikipedia.org/wiki/Topological_sorting">topological sort</a> implementation.</li>
<li>This runs in O(V+E) time</li>
<li>The returned ordered list of bindings can be used to determine provider field generation order.</li>
<li>Any binding whose order depends on one later in the returned order implicitly requires use of <code>DelegateFactory</code>.</li>
<li>Dependencies are traversed from public accessors and <code>inject()</code> functions.</li>
<li>Metro generates Provider Factory classes for each provider. These should be generated at the same time that the provider is compiled so that their factory classes. This is for two primary purposes:<ul>
<li>They can be reused to avoid code duplication</li>
<li>Metro can copy default values for provider values over to the generated factory to support optional dependencies. Since default values may refer to private references, we must generate these factories as nested classes.</li>
</ul>
</li>
<li>Metro generates a graph <em>impl</em> class that holds all aggregated bindings and manages scoping.</li>
<li>Scoped bindings are stored in provider fields backed by <code>DoubleCheck</code>.</li>
<li>Reused unscoped providers instances are stored in reusable fields.</li>
<li><code>@Provides</code> factory parameters are stored in a field backed by <code>InstanceFactory</code>.</li>
<li>Multibindings create new collection instances every time.</li>
<li>Multibinding providers are not accessible as standalone bindings.</li>
<li>Graph extensions are implemented via a combination of things<ul>
<li>Custom <code>MetroMetadata</code> is generated and serialized into Kotlin&rsquo;s <code>Metadata</code> annotations.</li>
<li>Extendable parent graphs opt-in to generating this metadata. They write information about their available provider and instance fields, binds callable IDs, parent graphs, and provides callable IDs.</li>
<li>Extendable parent graphs generate <code>_metroAccessor</code>-suffixed <code>internal</code> functions that expose instance fields and provider fields.</li>
<li>Child graphs read this metadata and look up the relevant callable symbols, then incorporating these when building its own binding graph.</li>
</ul>
</li>
</ul>
<h3 id="optimizations">Optimizations<a class="headerlink" href="#optimizations" title="Permanent link">&para;</a></h3>
<p>Metro applies several optimizations to generated graph code to reduce class size and improve runtime performance.</p>
<h4 id="unused-binding-elimination">Unused binding elimination<a class="headerlink" href="#unused-binding-elimination" title="Permanent link">&para;</a></h4>
<p>By default, Metro removes bindings that are not reachable from any accessor or member injector function. This reduces the size of generated code and avoids unnecessary initialization work.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@DependencyGraph</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">httpClient</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span><span class="w">  </span><span class="c1">// This is a root - it&#39;s reachable</span>

<span class="w">  </span><span class="kd">fun</span><span class="w"> </span><span class="nf">inject</span><span class="p">(</span><span class="n">memberInjectedClass</span><span class="p">:</span><span class="w"> </span><span class="n">MemberInjectedClass</span><span class="p">)</span><span class="w"> </span><span class="c1">// This is also a root</span>

<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideHttpClient</span><span class="p">():</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">()</span>

<span class="w">  </span><span class="c1">// This binding is NOT reachable from any accessor, so it will be eliminated</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideUnusedService</span><span class="p">():</span><span class="w"> </span><span class="n">UnusedService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UnusedService</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>This can be disabled via <code>metro.shrinkUnusedBindings=false</code> if you need all declared bindings to be generated (e.g., for debugging).</p>
<h4 id="property-collection">Property collection<a class="headerlink" href="#property-collection" title="Permanent link">&para;</a></h4>
<p>Not all bindings need dedicated provider fields. Metro analyzes the binding graph to determine which bindings require properties and what kind:</p>
<p><strong>Scoping</strong>: Scoped bindings (e.g. <code>@SingleIn</code>) always get a field backed by <code>DoubleCheck</code> to ensure lazy, thread-safe instantiation that is a singleton within the enclosing graph.</p>
<p><strong>Reference counting</strong>: Unscoped bindings used only once are inlined at their call site. Bindings used two or more times get a reusable provider field to avoid duplicate instantiation logic.</p>
<p><strong>Alias resolution</strong>: When counting references, Metro follows <code>@Binds</code> alias chains to the final implementation. If <code>Api</code> binds to <code>ApiImpl</code>, references to <code>Api</code> count toward <code>ApiImpl</code>&rsquo;s ref count.</p>
<p><strong>Multibinding source accessors</strong>: Bindings contributed to multibindings (<code>@IntoSet</code>, <code>@IntoMap</code>) that have dependencies are extracted into <em>getter</em> properties. This avoids duplicating dependency resolution code at each multibinding collection site and avoids risking <code>MethodTooLargeException</code> issues at compile-time.</p>
<h4 id="chunking">Chunking<a class="headerlink" href="#chunking" title="Permanent link">&para;</a></h4>
<p>JVM methods have a size limit. For graphs with many bindings, the constructor initialization code can exceed this limit. To avoid this, Metro splits initialization into multiple private <code>init</code> functions if necessary, each handling a subset of bindings.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated structure for a large graph:</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AppGraph</span><span class="err">$</span><span class="n">Impl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">provider1</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">provider2</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="p">...</span><span class="o">&gt;</span>
<span class="w">  </span><span class="c1">// ... hundreds more ...</span>

<span class="w">  </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">init1</span><span class="p">()</span>
<span class="w">    </span><span class="n">init2</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">init1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">provider1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="n">provider2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="c1">// ... up to statementsPerInitFun statements ...</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">init2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ... next batch ...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition configuration">
<p class="admonition-title">Configuration</p>
<table>
<thead>
<tr>
<th>Gradle Extension Property</th>
<th>Gradle/System Property</th>
<th>Compiler Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>chunkFieldInits</td>
<td><code>metro.chunkFieldInits</code></td>
<td><code>chunk-field-inits</code></td>
<td>Enable/disable chunking (default: <code>true</code>)</td>
</tr>
<tr>
<td>statementsPerInitFun</td>
<td><code>metro.statementsPerInitFun</code></td>
<td><code>statements-per-init-fun</code></td>
<td>Max statements per init function (default: <code>25</code>)</td>
</tr>
</tbody>
</table>
</div>
<h4 id="sharding">Sharding<a class="headerlink" href="#sharding" title="Permanent link">&para;</a></h4>
<p>For very large graphs, even chunking may not be enough — the class itself can exceed JVM&rsquo;s class file size limits. Sharding moves initialization logic into inner shard classes, distributing the code across multiple class files while keeping provider fields on the main graph class.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Generated structure with sharding:</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AppGraph</span><span class="err">$</span><span class="n">Impl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Provider fields stay on the main class</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">repoProvider</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="n">Repository</span><span class="o">&gt;</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">apiProvider</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="n">ApiService</span><span class="o">&gt;</span>
<span class="w">  </span><span class="c1">// ... many more ...</span>

<span class="w">  </span><span class="c1">// Shards hold initialization logic</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">inner</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Shard1</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">repoProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Repository</span><span class="p">.</span><span class="na">MetroFactory</span><span class="p">.</span><span class="na">create</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="n">apiProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ApiService</span><span class="p">.</span><span class="na">MetroFactory</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="na">repoProvider</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">inner</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Shard2</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ... next batch of initializations ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Shard1</span><span class="p">().</span><span class="na">initialize</span><span class="p">()</span>
<span class="w">    </span><span class="n">Shard2</span><span class="p">().</span><span class="na">initialize</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Sharding respects required binding initialization order and keeps strongly connected components (valid cycles broken by <code>Provider</code>/<code>Lazy</code>) together in the same shard.</p>
<p>This feature is disabled by default but will likely be enabled by default in the future.</p>
<div class="admonition configuration">
<p class="admonition-title">Configuration</p>
<table>
<thead>
<tr>
<th>Gradle Extension Property</th>
<th>Gradle/System Property</th>
<th>Compiler Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>enableGraphSharding</td>
<td><code>metro.enableGraphSharding</code></td>
<td><code>enable-graph-sharding</code></td>
<td>Enable/disable sharding (default: <code>false</code>)</td>
</tr>
<tr>
<td>keysPerGraphShard</td>
<td><code>metro.keysPerGraphShard</code></td>
<td><code>keys-per-graph-shard</code></td>
<td>Max bindings per shard (default: <code>2000</code>)</td>
</tr>
</tbody>
</table>
</div>
<h4 id="switching-providers">Switching Providers<a class="headerlink" href="#switching-providers" title="Permanent link">&para;</a></h4>
<p>Switching providers are an optimization in graph generation that defers class loading. This can reduce graph initialization time by deferring bindings&rsquo; class init until it&rsquo;s actually requested.</p>
<p>This is analogous to Dagger&rsquo;s <code>fastInit</code> option.</p>
<p>You should really <em>only</em> use this if you&rsquo;ve benchmarked it and measured a meaningful difference, as it comes with the same tradeoffs (always holding a graph instance ref, etc.)</p>
<div class="highlight"><pre><span></span><code><span class="c1">// The graph</span>
<span class="nd">@DependencyGraph</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="nd">@SingleIn</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideString</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span>
<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span><span class="nd">@SingleIn</span><span class="p">(</span><span class="n">AppScope</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideInt</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="na">length</span>

<span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">stringLength</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">}</span>

<span class="c1">// Generated structure for a graph with switching providers</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AppGraph</span><span class="err">$</span><span class="n">Impl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AppGraph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">provider1</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DoubleCheck</span><span class="p">.</span><span class="na">provider</span><span class="p">(</span><span class="n">SwitchingProvider</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">provider2</span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DoubleCheck</span><span class="p">.</span><span class="na">provider</span><span class="p">(</span><span class="n">SwitchingProvider</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>

<span class="w">  </span><span class="nd">@Provides</span><span class="w"> </span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SwitchingProvider</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">graph</span><span class="p">:</span><span class="w"> </span><span class="n">Impl</span><span class="p">,</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Provider</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">invoke</span><span class="p">():</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">StringFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(...)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">T</span>
<span class="w">        </span><span class="m">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">IntFactory</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="na">provider1</span><span class="p">())</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">T</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition configuration">
<p class="admonition-title">Configuration</p>
<table>
<thead>
<tr>
<th>Gradle Extension Property</th>
<th>Gradle/System Property</th>
<th>Compiler Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>enableSwitchingProviders</td>
<td><code>metro.enableSwitchingProviders</code></td>
<td><code>enable-switching-providers</code></td>
<td>Enable/disable switching providers (default: <code>false</code>)</td>
</tr>
</tbody>
</table>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Zac Sweers
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.code.select", "content.action.edit", "content.action.view", "content.tabs.link"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>