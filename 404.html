<!doctype html>
<!--
  Metro Documentation 404 Page - Enhanced Smart Redirect System
  
  Purpose:
  This 404 page provides intelligent redirects for the Metro documentation site.
  Instead of showing a generic error, it attempts to find the requested page in
  the latest version and redirect users appropriately.

  Background:
  Metro uses versioned mkdocs site snapshot using mike. Additionally, old versions
  are periodically cleaned up. So, having smart redirect will help user land on 
  same page if it exists in latest version, or otherwise fallback to latest release site.
  
  Configuration:
  The METRO_CONFIG object (defined in the JavaScript section) centralizes all
  path configurations required for the redirect logic.

  ℹ️ NOTE:
  The static page uses a snapshot of MkDocs Material assets stored in /404-assets/
  to ensure long-term stability. These assets are version-independent and won't break
  when the main site is updated with new MkDocs Material versions.
-->
<html lang="en" class="no-js">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <meta name="description" content="A multiplatform dependency injection framework for Kotlin">
  <meta name="author" content="Zac Sweers">
  <link rel="canonical" href="https://zacsweers.github.io/metro/404.html">
  <link rel="icon" href="/metro/latest/site-assets/img/favicon.ico">
  <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
  <title>Page Not Found - 🚇 Metro</title>
  <link rel="stylesheet" href="/metro/404-assets/stylesheets/main.min.css">
  <link rel="stylesheet" href="/metro/404-assets/stylesheets/palette.min.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
  <style>
    :root {
      --md-text-font: "Inter";
      --md-code-font: "Fira Code"
    }
  </style>
  <script>__md_scope = new URL(".", location), __md_hash = e => [...e].reduce(((e, _) => (e << 5) - e + _.charCodeAt(0)), 0), __md_get = (e, _ = localStorage, t = __md_scope) => JSON.parse(_.getItem(t.pathname + "." + e)), __md_set = (e, _, t = localStorage, a = __md_scope) => { try { t.setItem(a.pathname + "." + e, JSON.stringify(_)) } catch (e) { } }</script>
  <meta property="og:type" content="website">
  <meta property="og:title" content="Page Not Found - Metro">
  <meta property="og:description" content="A multiplatform dependency injection framework for Kotlin">
  <meta property="og:image" content="https://zacsweers.github.io/metro/latest/assets/images/social/index.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://zacsweers.github.io/metro/404.html">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Page Not Found - Metro">
  <meta name="twitter:description" content="A multiplatform dependency injection framework for Kotlin">
  <meta name="twitter:image" content="https://zacsweers.github.io/metro/latest/assets/images/social/index.png">
</head>

<body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="green">
  
  <!-- Enhanced 404 Smart Redirect System - Execute immediately -->
  <noscript>
    <meta http-equiv="refresh" content="1; url=/metro/latest/" />
  </noscript>
  <script>
    // Enhanced 404 page with smart redirects
    // Reads versions.json to determine latest version and handle redirects intelligently

    // Global configuration
    const METRO_CONFIG = {
      basePath: "/metro",
      latestAlias: "latest",
      versionsEndpoint: "/metro/versions.json",
      get fallbackUrl() {
        return `${this.basePath}/${this.latestAlias}/`;
      },
      get latestUrl() {
        return `${this.basePath}/${this.latestAlias}`;
      }
    };

    // Update noscript fallback to use config
    document.addEventListener('DOMContentLoaded', function() {
      const noscriptMeta = document.querySelector('noscript meta[http-equiv="refresh"]');
      if (noscriptMeta) {
        noscriptMeta.setAttribute('content', `1; url=${METRO_CONFIG.fallbackUrl}`);
      }

      // Update navigation links to use config
      updateNavigationLinks();
    });

    // Function to update navigation links with config values
    function updateNavigationLinks() {
      const linkMappings = [
        { selector: 'a[href="/metro/latest/"]', path: '' },
        { selector: 'a[href="/metro/latest/installation/"]', path: 'installation/' },
        { selector: 'a[href="/metro/latest/features/"]', path: 'features/' }
      ];

      linkMappings.forEach(({ selector, path }) => {
        const links = document.querySelectorAll(selector);
        links.forEach(link => {
          link.href = `${METRO_CONFIG.latestUrl}/${path}`;
        });
      });
    }

    async function smartRedirect() {
      try {
        const startTime = performance.now();
        console.log('🚇 Smart redirect started');

        const currentPath = window.location.pathname;
        const fallbackUrl = METRO_CONFIG.fallbackUrl;

        // Parse the current URL to extract version and page path
        const pathMatch = currentPath.match(new RegExp(`^${METRO_CONFIG.basePath.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\/([^\\/]+)\\/(.*)$`));
        if (!pathMatch) {
          // If URL doesn't match expected pattern, fallback to latest
          console.log('❌ URL pattern not recognized, falling back to latest');
          window.location.replace(fallbackUrl);
          return;
        }

        const [, requestedVersion, pagePath] = pathMatch;
        const hashFragment = window.location.hash; // Preserve anchor/fragment
        console.log(`📍 Requested: ${requestedVersion}/${pagePath}${hashFragment}`);

        // Normalize HTML-based URLs to directory-based URLs
        // e.g., "compatibility.html" -> "compatibility/"
        let normalizedPagePath = pagePath;
        if (pagePath.endsWith('.html')) {
          // Remove .html extension and add trailing slash for directory-style URLs
          const pathWithoutExtension = pagePath.slice(0, -5); // Remove '.html'
          if (pathWithoutExtension && pathWithoutExtension !== 'index') {
            normalizedPagePath = pathWithoutExtension + '/';
            console.log(`🔄 Normalized HTML URL: ${pagePath} -> ${normalizedPagePath}`);
          } else if (pathWithoutExtension === 'index') {
            // index.html maps to root directory
            normalizedPagePath = '';
            console.log(`🔄 Normalized index.html to root directory`);
          }
        }

        // Fetch versions.json to get current version information
        const versionsFetchStart = performance.now();
        console.log('📡 Fetching versions.json...');

        const versionsResponse = await fetch(METRO_CONFIG.versionsEndpoint);
        if (!versionsResponse.ok) {
          throw new Error('Failed to fetch versions.json');
        }

        const versions = await versionsResponse.json();
        const versionsFetchEnd = performance.now();
        console.log(`✅ versions.json fetched in ${(versionsFetchEnd - versionsFetchStart).toFixed(2)}ms`);

        // Find the latest version (the one with "latest" alias)
        const latestVersion = versions.find(v => v.aliases && v.aliases.includes(METRO_CONFIG.latestAlias));
        if (!latestVersion) {
          // If no latest version found, fallback
          console.log('❌ No latest version found in versions.json');
          window.location.replace(fallbackUrl);
          return;
        }

        console.log(`🎯 Latest version identified: ${latestVersion.version}`);

        // If the requested version is the same as latest, something else is wrong
        if (requestedVersion === latestVersion.version || requestedVersion === METRO_CONFIG.latestAlias) {
          console.log('ℹ️ Requested version is already latest, redirecting to home');
          window.location.replace(fallbackUrl);
          return;
        }

        // Construct the target URL with the latest version and normalized path
        const baseTargetUrl = `${METRO_CONFIG.latestUrl}/${normalizedPagePath}`;
        const targetUrlWithFragment = `${baseTargetUrl}${hashFragment}`;
        console.log(`🔍 Checking if page exists: ${baseTargetUrl}${hashFragment ? ` (with fragment: ${hashFragment})` : ''}`);

        // Check if the page exists in the latest version (without fragment for HEAD request)
        const pageCheckStart = performance.now();
        const pageCheckResponse = await fetch(baseTargetUrl, { method: 'HEAD' });
        const pageCheckEnd = performance.now();

        console.log(`📊 Page check completed in ${(pageCheckEnd - pageCheckStart).toFixed(2)}ms (Status: ${pageCheckResponse.status})`);

        if (pageCheckResponse.ok) {
          // Page exists in latest version, redirect there
          const totalTime = performance.now() - startTime;
          console.log(`✅ Redirecting from ${currentPath}${hashFragment} to ${targetUrlWithFragment}`);
          console.log(`⏱️ Total redirect process took ${totalTime.toFixed(2)}ms`);
          
          // Show appropriate message based on whether we normalized the URL
          const targetPageName = normalizedPagePath ? 
            (normalizedPagePath === pagePath ? normalizedPagePath.split('/').filter(p => p).pop() : `${normalizedPagePath.split('/').filter(p => p).pop()} (updated URL format)`) : 
            'home page';
          const fragmentMessage = hashFragment ? ` with anchor ${hashFragment}` : '';
          updateMessage(`Found page in latest version. Redirecting to ${targetPageName}${fragmentMessage}...`);
          
          setTimeout(() => {
            hideLoading();
            window.location.replace(targetUrlWithFragment);
          }, 500);
        } else {
          // Page doesn't exist in latest version, fallback to home
          const totalTime = performance.now() - startTime;
          console.log(`❌ Page ${normalizedPagePath || pagePath} not found in latest version, redirecting to home`);
          console.log(`⏱️ Total process took ${totalTime.toFixed(2)}ms before fallback`);
          updateMessage('Page not found in latest version. Redirecting to home page...');
          setTimeout(() => {
            hideLoading();
            window.location.replace(fallbackUrl);
          }, 1000);
        }

      } catch (error) {
        const totalTime = performance.now() - startTime;
        console.error('💥 Error in smart redirect:', error);
        console.log(`⏱️ Process failed after ${totalTime.toFixed(2)}ms`);
        updateMessage('Error occurred during redirect. Taking you to the home page...');
        // On any error, fallback to latest home page
        setTimeout(() => {
          hideLoading();
          window.location.replace(METRO_CONFIG.fallbackUrl);
        }, 1000);
      }
    }

    // Helper function to update the redirect message
    function updateMessage(text) {
      const message = document.getElementById('redirect-message');
      const loadingIndicator = document.getElementById('loading-indicator');
      if (message) {
        message.textContent = text;
      }
      if (loadingIndicator) {
        loadingIndicator.style.display = 'inline-flex';
      }
    }

    // Hide loading indicator when redirecting
    function hideLoading() {
      const loadingIndicator = document.getElementById('loading-indicator');
      if (loadingIndicator) {
        loadingIndicator.style.display = 'none';
      }
    }

    // Execute smart redirect when page loads
    smartRedirect();

    // Update message after a short delay to show we're working
    setTimeout(() => {
      const hasFragment = window.location.hash;
      const fragmentText = hasFragment ? ' (preserving anchor)' : '';
      updateMessage(`Analyzing URL and checking latest version${fragmentText}...`);
    }, 500);
  </script>

  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
  <!-- Search is disabled on 404 page to prevent errors from missing search indexes -->
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off" disabled style="display: none;">
  <label class="md-overlay" for="__drawer"></label>
  <div data-md-component="skip">


    <a href="#page-not-found" class="md-skip">
      Skip to content
    </a>

  </div>
  <div data-md-component="announce">

  </div>

  <div data-md-color-scheme="default" data-md-component="outdated" hidden>

  </div>


  <header class="md-header md-header--shadow" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
      <a href="/metro/latest/index.html" title="Metro" class="md-header__button md-logo" aria-label="Metro"
        data-md-component="logo">

        <img src="/metro/latest/site-assets/img/metro-icon.svg" alt="logo">

      </a>
      <label class="md-header__button md-icon" for="__drawer">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z" />
        </svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              Metro
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">

              Page Not Found

            </span>
          </div>
        </div>
      </div>


      <form class="md-header__option" data-md-component="palette">

        <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default"
          data-md-color-primary="white" data-md-color-accent="green" aria-label="Switch to dark mode" type="radio"
          name="__palette" id="__palette_0" checked>

        <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z" />
          </svg>
        </label>

        <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate"
          data-md-color-primary="black" data-md-color-accent="green" aria-label="Switch to light mode" type="radio"
          name="__palette" id="__palette_1">

        <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z" />
          </svg>
        </label>


      </form>



      <script>var palette = __md_get("__palette"); if (palette && palette.color) { if ("(prefers-color-scheme)" === palette.color.media) { var media = matchMedia("(prefers-color-scheme: light)"), input = document.querySelector(media.matches ? "[data-md-color-media='(prefers-color-scheme: light)']" : "[data-md-color-media='(prefers-color-scheme: dark)']"); palette.color.media = input.getAttribute("data-md-color-media"), palette.color.scheme = input.getAttribute("data-md-color-scheme"), palette.color.primary = input.getAttribute("data-md-color-primary"), palette.color.accent = input.getAttribute("data-md-color-accent") } for (var [key, value] of Object.entries(palette.color)) document.body.setAttribute("data-md-color-" + key, value) }</script>

      <!-- Force light mode initialization -->
      <script>
        // Ensure light mode is set by default for 404 page
        document.body.setAttribute("data-md-color-scheme", "default");
        document.body.setAttribute("data-md-color-primary", "white");
        document.body.setAttribute("data-md-color-accent", "green");

        // Check the light mode radio button
        const lightModeInput = document.getElementById("__palette_0");
        if (lightModeInput) {
          lightModeInput.checked = true;
        }
      </script>

      <label class="md-header__button md-icon" for="__search" style="display: none;">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5" />
        </svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog" style="display: none;">
        <label class="md-search__overlay" for="__search"></label>
        <div class="md-search__inner" role="search">
          <form class="md-search__form" name="search">
            <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search"
              autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false"
              data-md-component="search-query" required>
            <label class="md-search__icon md-icon" for="__search">

              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path
                  d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5" />
              </svg>

              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z" />
              </svg>
            </label>
            <nav class="md-search__options" aria-label="Search">

              <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
              </button>
            </nav>

          </form>
          <div class="md-search__output">
            <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
              <div class="md-search-result" data-md-component="search-result">
                <div class="md-search-result__meta">
                  Initializing search
                </div>
                <ol class="md-search-result__list" role="presentation"></ol>
              </div>
            </div>
          </div>
        </div>
      </div>



      <div class="md-header__source">
        <a href="https://github.com/ZacSweers/metro" title="Go to repository" class="md-source"
          data-md-component="source">
          <div class="md-source__icon md-icon">

            <svg xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.-->
              <path fill="currentColor"
                d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4" />
            </svg>
          </div>
          <div class="md-source__repository">
            Metro
          </div>
        </a>
      </div>

    </nav>

  </header>

  <div class="md-container" data-md-component="container">

    <main class="md-main" data-md-component="main">
      <div class="md-main__inner md-grid">


        <div class="md-content" data-md-component="content">
          <article class="md-content__inner md-typeset">

            <h1 id="page-not-found">🚇 Page Not Found<a class="headerlink" href="#page-not-found"
                title="Permanent link">&para;</a></h1>

            <p>The page you're looking for doesn't exist or might have been moved to a newer version.</p>

            <div class="md-typeset">
              <div class="admonition info">
                <p class="admonition-title">Smart Redirect</p>
                <p id="redirect-message">Checking for the page in the latest version...</p>
                <div id="loading-indicator" style="display: none; align-items: center; gap: 8px; margin-top: 8px;">
                  <div
                    style="width: 16px; height: 16px; border: 2px solid var(--md-default-fg-color--lighter); border-top: 2px solid var(--md-accent-fg-color); border-radius: 50%; animation: spin 1s linear infinite;">
                  </div>
                  <span>Processing redirect...</span>
                </div>
              </div>
            </div>

            <p>If you're not redirected automatically, you can:</p>

            <ul>
              <li><a href="/metro/latest/">Go to the latest documentation</a></li>
              <li><a href="/metro/latest/installation/">View installation instructions</a></li>
              <li><a href="/metro/latest/features/">Explore Metro features</a></li>
              <li><a href="https://github.com/ZacSweers/metro">Visit the GitHub repository</a></li>
            </ul>

            <div class="md-typeset">
              <div class="admonition tip">
                <p class="admonition-title">Looking for something specific?</p>
                <p>Browse the <a href="/metro/latest/">latest documentation</a> to find what you need, or visit the <a href="https://github.com/ZacSweers/metro">GitHub repository</a> for code and issues.</p>
              </div>
            </div>

            <style>
              @keyframes spin {
                0% {
                  transform: rotate(0deg);
                }

                100% {
                  transform: rotate(360deg);
                }
              }

              #loading-indicator {
                font-size: 0.9em;
                color: var(--md-default-fg-color--light);
              }

              /* Hide mike version dropdown on 404 page */
              .md-version {
                display: none !important;
              }
            </style>

          </article>
        </div>


        <script>var target = document.getElementById(location.hash.slice(1)); target && target.name && (target.checked = target.name.startsWith("__tabbed_"))</script>
      </div>

    </main>

    <footer class="md-footer">

      <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
          <div class="md-copyright">

            <div class="md-copyright__highlight">
              Copyright &copy; 2025 Zac Sweers
            </div>


            Made with
            <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
              Material for MkDocs
            </a>

          </div>

        </div>
      </div>
    </footer>

  </div>
  <div class="md-dialog" data-md-component="dialog">
    <div class="md-dialog__inner md-typeset"></div>
  </div>




  <script id="__config"
    type="application/json">{"base": ".", "features": ["content.code.copy", "content.code.select"], "search": null, "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>


  <script src="/metro/404-assets/javascripts/bundle.min.js"></script>


</body>

</html>